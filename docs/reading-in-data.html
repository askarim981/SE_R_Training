<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Reading in Data | An R Training Resource</title>
  <meta name="description" content="4 Reading in Data | An R Training Resource" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Reading in Data | An R Training Resource" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Reading in Data | An R Training Resource" />
  
  
  

<meta name="author" content="Tom Harris" />


<meta name="date" content="2023-09-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Functions.html"/>
<link rel="next" href="creating-outputs.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">An R Training Resource</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="Basics.html"><a href="Basics.html"><i class="fa fa-check"></i><b>2</b> Basics of R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Basics.html"><a href="Basics.html#r-and-r-studio"><i class="fa fa-check"></i><b>2.1</b> R and R studio</a></li>
<li class="chapter" data-level="2.2" data-path="Basics.html"><a href="Basics.html#files"><i class="fa fa-check"></i><b>2.2</b> Files</a></li>
<li class="chapter" data-level="2.3" data-path="Basics.html"><a href="Basics.html#Projects"><i class="fa fa-check"></i><b>2.3</b> R Projects</a></li>
<li class="chapter" data-level="2.4" data-path="Basics.html"><a href="Basics.html#r-studios-panes"><i class="fa fa-check"></i><b>2.4</b> R Studio’s Panes</a></li>
<li class="chapter" data-level="2.5" data-path="Basics.html"><a href="Basics.html#packages"><i class="fa fa-check"></i><b>2.5</b> Packages</a></li>
<li class="chapter" data-level="2.6" data-path="Basics.html"><a href="Basics.html#data-types"><i class="fa fa-check"></i><b>2.6</b> Data types</a></li>
<li class="chapter" data-level="2.7" data-path="Basics.html"><a href="Basics.html#data-structures"><i class="fa fa-check"></i><b>2.7</b> Data structures</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="Basics.html"><a href="Basics.html#data-frames"><i class="fa fa-check"></i><b>2.7.1</b> Data Frames</a></li>
<li class="chapter" data-level="2.7.2" data-path="Basics.html"><a href="Basics.html#vectors"><i class="fa fa-check"></i><b>2.7.2</b> Vectors</a></li>
<li class="chapter" data-level="2.7.3" data-path="Basics.html"><a href="Basics.html#factors"><i class="fa fa-check"></i><b>2.7.3</b> Factors</a></li>
<li class="chapter" data-level="2.7.4" data-path="Basics.html"><a href="Basics.html#matrices"><i class="fa fa-check"></i><b>2.7.4</b> Matrices</a></li>
<li class="chapter" data-level="2.7.5" data-path="Basics.html"><a href="Basics.html#lists"><i class="fa fa-check"></i><b>2.7.5</b> Lists</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Functions.html"><a href="Functions.html"><i class="fa fa-check"></i><b>3</b> Syntax and Functions</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Functions.html"><a href="Functions.html#syntax"><i class="fa fa-check"></i><b>3.1</b> Syntax</a></li>
<li class="chapter" data-level="3.2" data-path="Functions.html"><a href="Functions.html#baser-functions"><i class="fa fa-check"></i><b>3.2</b> BaseR Functions</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="Functions.html"><a href="Functions.html#base-r-and-inbuilt-functions"><i class="fa fa-check"></i><b>3.2.1</b> Base R and Inbuilt Functions</a></li>
<li class="chapter" data-level="3.2.2" data-path="Functions.html"><a href="Functions.html#programming-functions"><i class="fa fa-check"></i><b>3.2.2</b> Programming functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reading-in-data.html"><a href="reading-in-data.html"><i class="fa fa-check"></i><b>4</b> Reading in Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="reading-in-data.html"><a href="reading-in-data.html#good-practice"><i class="fa fa-check"></i><b>4.1</b> Good practice</a></li>
<li class="chapter" data-level="4.2" data-path="reading-in-data.html"><a href="reading-in-data.html#reading-in-.csvs-and-excel-workbooks"><i class="fa fa-check"></i><b>4.2</b> Reading in .csvs and excel workbooks</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="reading-in-data.html"><a href="reading-in-data.html#csvs"><i class="fa fa-check"></i><b>4.2.1</b> .csvs</a></li>
<li class="chapter" data-level="4.2.2" data-path="reading-in-data.html"><a href="reading-in-data.html#large-.csvs"><i class="fa fa-check"></i><b>4.2.2</b> Large .csvs</a></li>
<li class="chapter" data-level="4.2.3" data-path="reading-in-data.html"><a href="reading-in-data.html#excel-workbooks"><i class="fa fa-check"></i><b>4.2.3</b> Excel workbooks</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="reading-in-data.html"><a href="reading-in-data.html#sql"><i class="fa fa-check"></i><b>4.3</b> SQL</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="reading-in-data.html"><a href="reading-in-data.html#connecting-to-databases"><i class="fa fa-check"></i><b>4.3.1</b> Connecting to databases</a></li>
<li class="chapter" data-level="4.3.2" data-path="reading-in-data.html"><a href="reading-in-data.html#loading-data-into-r"><i class="fa fa-check"></i><b>4.3.2</b> Loading data into R</a></li>
<li class="chapter" data-level="4.3.3" data-path="reading-in-data.html"><a href="reading-in-data.html#running-sql-queries"><i class="fa fa-check"></i><b>4.3.3</b> Running SQL Queries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="creating-outputs.html"><a href="creating-outputs.html"><i class="fa fa-check"></i><b>5</b> Creating outputs</a>
<ul>
<li class="chapter" data-level="5.1" data-path="creating-outputs.html"><a href="creating-outputs.html#writing-.csvs"><i class="fa fa-check"></i><b>5.1</b> Writing <code>.csvs</code></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="creating-outputs.html"><a href="creating-outputs.html#writing-multiple-outputs-as-sheets-of-an-excel-file"><i class="fa fa-check"></i><b>5.1.1</b> Writing multiple outputs as sheets of an excel file</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="creating-outputs.html"><a href="creating-outputs.html#saving-objects"><i class="fa fa-check"></i><b>5.2</b> Saving objects</a></li>
<li class="chapter" data-level="5.3" data-path="creating-outputs.html"><a href="creating-outputs.html#saving-graphs"><i class="fa fa-check"></i><b>5.3</b> Saving graphs</a></li>
<li class="chapter" data-level="5.4" data-path="creating-outputs.html"><a href="creating-outputs.html#r-markdown"><i class="fa fa-check"></i><b>5.4</b> R Markdown</a></li>
<li class="chapter" data-level="5.5" data-path="creating-outputs.html"><a href="creating-outputs.html#presentations"><i class="fa fa-check"></i><b>5.5</b> Presentations</a></li>
<li class="chapter" data-level="5.6" data-path="creating-outputs.html"><a href="creating-outputs.html#other-links"><i class="fa fa-check"></i><b>5.6</b> Other links</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>6</b> Data manipulation</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-manipulation.html"><a href="data-manipulation.html#selecting"><i class="fa fa-check"></i><b>6.1</b> Selecting</a></li>
<li class="chapter" data-level="6.2" data-path="data-manipulation.html"><a href="data-manipulation.html#filtering"><i class="fa fa-check"></i><b>6.2</b> Filtering</a></li>
<li class="chapter" data-level="6.3" data-path="data-manipulation.html"><a href="data-manipulation.html#summarising"><i class="fa fa-check"></i><b>6.3</b> Summarising</a></li>
<li class="chapter" data-level="6.4" data-path="data-manipulation.html"><a href="data-manipulation.html#grouping-by"><i class="fa fa-check"></i><b>6.4</b> Grouping by</a></li>
<li class="chapter" data-level="6.5" data-path="data-manipulation.html"><a href="data-manipulation.html#totals"><i class="fa fa-check"></i><b>6.5</b> Totals</a></li>
<li class="chapter" data-level="6.6" data-path="data-manipulation.html"><a href="data-manipulation.html#mutating"><i class="fa fa-check"></i><b>6.6</b> Mutate</a></li>
<li class="chapter" data-level="6.7" data-path="data-manipulation.html"><a href="data-manipulation.html#pivotting"><i class="fa fa-check"></i><b>6.7</b> Pivotting</a></li>
<li class="chapter" data-level="6.8" data-path="data-manipulation.html"><a href="data-manipulation.html#joining-data"><i class="fa fa-check"></i><b>6.8</b> Joining data</a></li>
<li class="chapter" data-level="6.9" data-path="data-manipulation.html"><a href="data-manipulation.html#extracting_variables"><i class="fa fa-check"></i><b>6.9</b> Extracting variables</a></li>
<li class="chapter" data-level="6.10" data-path="data-manipulation.html"><a href="data-manipulation.html#others"><i class="fa fa-check"></i><b>6.10</b> Others</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="user-defined-functions.html"><a href="user-defined-functions.html"><i class="fa fa-check"></i><b>7</b> User-defined Functions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="user-defined-functions.html"><a href="user-defined-functions.html#Overview"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="user-defined-functions.html"><a href="user-defined-functions.html#basic-examples"><i class="fa fa-check"></i><b>7.2</b> Basic examples</a></li>
<li class="chapter" data-level="7.3" data-path="user-defined-functions.html"><a href="user-defined-functions.html#returning-objects"><i class="fa fa-check"></i><b>7.3</b> Returning objects</a></li>
<li class="chapter" data-level="7.4" data-path="user-defined-functions.html"><a href="user-defined-functions.html#passing-objects"><i class="fa fa-check"></i><b>7.4</b> Passing objects</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="user-defined-functions.html"><a href="user-defined-functions.html#creating-the-function"><i class="fa fa-check"></i><b>7.4.1</b> Creating the function</a></li>
<li class="chapter" data-level="7.4.2" data-path="user-defined-functions.html"><a href="user-defined-functions.html#passing-data"><i class="fa fa-check"></i><b>7.4.2</b> Passing data</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="user-defined-functions.html"><a href="user-defined-functions.html#setting-default-inputs"><i class="fa fa-check"></i><b>7.5</b> Setting default inputs</a></li>
<li class="chapter" data-level="7.6" data-path="user-defined-functions.html"><a href="user-defined-functions.html#Loops"><i class="fa fa-check"></i><b>7.6</b> Using Loops</a></li>
<li class="chapter" data-level="7.7" data-path="user-defined-functions.html"><a href="user-defined-functions.html#random-snippets"><i class="fa fa-check"></i><b>7.7</b> Random snippets</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="graphs.html"><a href="graphs.html"><i class="fa fa-check"></i><b>8</b> Graphs</a>
<ul>
<li class="chapter" data-level="8.1" data-path="graphs.html"><a href="graphs.html#graphical-resources"><i class="fa fa-check"></i><b>8.1</b> Graphical resources</a></li>
<li class="chapter" data-level="8.2" data-path="graphs.html"><a href="graphs.html#tips"><i class="fa fa-check"></i><b>8.2</b> Tips</a></li>
<li class="chapter" data-level="8.3" data-path="graphs.html"><a href="graphs.html#arranging"><i class="fa fa-check"></i><b>8.3</b> Arranging</a></li>
<li class="chapter" data-level="8.4" data-path="graphs.html"><a href="graphs.html#basic-interactivity"><i class="fa fa-check"></i><b>8.4</b> Basic interactivity</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>9</b> Spatial</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An R Training Resource</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reading-in-data" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Reading in Data<a href="reading-in-data.html#reading-in-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>One of R’s best applications is for manipulating and analysing data. However, R doesn’t have a store of data (aside from some basic pre-loaded datasets). We need to save this outside the R environment and then load or read it into R. Our data tends to be stored in excel files - either workbooks or .csvs - or SQL databases. You can also read in data from Stata and other programmes. Use Google to find packages that allow you to read in this data, if this is how your data is stored.</p>
<p>This section uses 3x Higher Education-focused examples of reading in data. If you set your working directory as per the code below, you will be able to read in the data files being used.</p>
<div id="good-practice" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Good practice<a href="reading-in-data.html#good-practice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As shown below, <strong>documentation is essential</strong>. For example, if you download data from HESA and delete the 14-18 rows of table identifiers, a future analyst or QA analyst will struggle to identify the source of the data, or to verify that filters are correct.</p>
<p>Equally, with any other data source, if you do not include very clear links to</p>
<ul>
<li>the source,</li>
<li>[if relevant] when it was accessed,</li>
<li>[if relevant] where from within that source the data come,</li>
</ul>
<p>then it is impossible to verify the source data.</p>
<p>It is good practice to store this information at the top of a document; in a log of input data; or within your code.</p>
</div>
<div id="reading-in-.csvs-and-excel-workbooks" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Reading in .csvs and excel workbooks<a href="reading-in-data.html#reading-in-.csvs-and-excel-workbooks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You can read in data using the whole file URL or from a relative file path, using your current working directory as a root. A reminder of how to check your directory is below. Refer to section <a href="Basics.html#Projects">2.2: R Projects</a> for more detail.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="reading-in-data.html#cb32-1" tabindex="-1"></a><span class="fu">getwd</span>() </span>
<span id="cb32-2"><a href="reading-in-data.html#cb32-2" tabindex="-1"></a><span class="co">#if your directory is not where it needs to be to load data or source a file, set it</span></span>
<span id="cb32-3"><a href="reading-in-data.html#cb32-3" tabindex="-1"></a></span>
<span id="cb32-4"><a href="reading-in-data.html#cb32-4" tabindex="-1"></a><span class="co">#Alternatively, you can navigate through to the relative path, as long as the location is on the same drive.</span></span>
<span id="cb32-5"><a href="reading-in-data.html#cb32-5" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb32-6"><a href="reading-in-data.html#cb32-6" tabindex="-1"></a></span>
<span id="cb32-7"><a href="reading-in-data.html#cb32-7" tabindex="-1"></a><span class="co"># All of the data files used in the book are saved in this file path. </span></span>
<span id="cb32-8"><a href="reading-in-data.html#cb32-8" tabindex="-1"></a><span class="co"># If you run this code, all the file reading functions below will load the appropriate data. </span></span>
<span id="cb32-9"><a href="reading-in-data.html#cb32-9" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">&quot;//vmt1pr-dhfs01/Working/HE-EAT-WKG-FS/HEEAT Technical Resources/R/Core learning RBookdown&quot;</span>) </span></code></pre></div>
<div id="csvs" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> .csvs<a href="reading-in-data.html#csvs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>read.csv()</code> function is pre-loaded into R through the utils package. We will usually want to assign the loaded data to an object, so that we have it stored in our global environment.</p>
<p>A CAH1 subjects .csv is downloaded from HESA. It is saved in the project’s data folder. I have done nothing to the file other than save it as a UTF-8 comma delimited .csv file. The first 16 rows of the HESA data contain unique identifiers, details about the source and file specification, which can be referred back to.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="reading-in-data.html#cb33-1" tabindex="-1"></a>CAH1_By_Provider <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">&quot;Data/CAH1 Subjects.csv&quot;</span>) </span></code></pre></div>
<p><img src="images%20and%20graphics/Reading%20in%20data%20errors.JPG" width="80%" style="display: block; margin: auto;" /></p>
<p><strong>BUT</strong> reading this in will create a data frame with lots of blank values, missing column titles and irrelevant rows.</p>
<p>Because the top 16 rows are useful for documentation and finding the data source, we want to keep these in the .csv file, but we don’t want R to read them into R, so we tell the read.csv function to skip them.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="reading-in-data.html#cb34-1" tabindex="-1"></a>CAH1_By_Provider <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">&quot;Data/CAH1 Subjects.csv&quot;</span>, <span class="at">skip =</span> <span class="dv">16</span>)</span></code></pre></div>
<p>If we want the column names exactly how they appear in the data, we can add the <code>check.names = FALSE argument</code>. When referencing these columns, you will need to put the name inside tilted apostrophes in order to tell R that the object has spaces in it, otherwise R will read a single column heading as many, and you will get an error.
<em>This is why it is common to use underscores when naming objects and variables</em></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="reading-in-data.html#cb35-1" tabindex="-1"></a>CAH1_By_Provider <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">&quot;Data/CAH1 Subjects.csv&quot;</span>, <span class="at">skip =</span> <span class="dv">16</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Now we have a rectangular dataset with non blank values and the column names we want. But when we check the data format, we find that, other than the UKPRN column, the other numeric data has been read in as character data. We can see this with <code>str(CAH1_By_Provider)</code></p>
<p>You can change this by selecting which columns you want to be numeric. We want columns 3 to 27 to be numeric (i.e. every column from the 3rd column to the 27th)</p>
<p>If you simply specify that you want them <code>as.numeric</code>, R will turn the values with commas into NAs. One way to avoid this is using readr’s <code>parse_number</code> function from the <code>readr</code> package.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="reading-in-data.html#cb36-1" tabindex="-1"></a><span class="co"># load readr</span></span>
<span id="cb36-2"><a href="reading-in-data.html#cb36-2" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb36-3"><a href="reading-in-data.html#cb36-3" tabindex="-1"></a></span>
<span id="cb36-4"><a href="reading-in-data.html#cb36-4" tabindex="-1"></a><span class="co"># create a new object with columns 3 to 27 now numeric</span></span>
<span id="cb36-5"><a href="reading-in-data.html#cb36-5" tabindex="-1"></a>Numeric_CAH1_By_Provider <span class="ot">&lt;-</span> CAH1_By_Provider <span class="sc">%&gt;%</span></span>
<span id="cb36-6"><a href="reading-in-data.html#cb36-6" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">27</span>, readr<span class="sc">::</span>parse_number) </span>
<span id="cb36-7"><a href="reading-in-data.html#cb36-7" tabindex="-1"></a></span>
<span id="cb36-8"><a href="reading-in-data.html#cb36-8" tabindex="-1"></a><span class="co"># check the structure of the data</span></span>
<span id="cb36-9"><a href="reading-in-data.html#cb36-9" tabindex="-1"></a><span class="fu">str</span>(Numeric_CAH1_By_Provider) <span class="co"># we can now see that columns 3 to 27 are numeric</span></span></code></pre></div>
<p>You can now explore the data as shown in segment 2.5.1 - <a href="Basics.html#data-frames">Data Frames</a></p>
<p>In some cases, R might create funky column headings. Some options for solving might include</p>
<ul>
<li>use <code>fileEncoding = "UTF-8-BOM"</code> as an argument within the read.csv function</li>
<li>check the source data</li>
</ul>
<p>Some other examples of making data numeric or replacing NAs with 0</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="reading-in-data.html#cb37-1" tabindex="-1"></a><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">CAH2 Subject</span><span class="st">`</span>),  <span class="sc">~</span><span class="fu">as.numeric</span>(.x)))</span>
<span id="cb37-2"><a href="reading-in-data.html#cb37-2" tabindex="-1"></a><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(Subject), <span class="sc">~</span> readr<span class="sc">::</span><span class="fu">parse_number</span>(.x)))</span>
<span id="cb37-3"><a href="reading-in-data.html#cb37-3" tabindex="-1"></a><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">replace_na</span>(., <span class="dv">0</span>)))</span>
<span id="cb37-4"><a href="reading-in-data.html#cb37-4" tabindex="-1"></a></span>
<span id="cb37-5"><a href="reading-in-data.html#cb37-5" tabindex="-1"></a><span class="co"># remove rows where all values are #N/A</span></span>
<span id="cb37-6"><a href="reading-in-data.html#cb37-6" tabindex="-1"></a><span class="fu">filter_at</span>(<span class="fu">vars</span>(<span class="fu">everything</span>()), <span class="fu">all_vars</span>(<span class="sc">!</span><span class="fu">is.na</span>(.)))</span></code></pre></div>
</div>
<div id="large-.csvs" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Large .csvs<a href="reading-in-data.html#large-.csvs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>fread()</code> function is faster than read.csv, but has less flexibility.</p>
</div>
<div id="excel-workbooks" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Excel workbooks<a href="reading-in-data.html#excel-workbooks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It might be that you want to store lots of sheets in a single workbook, and want to read in a particular sheet. It also might be that you want to do some manipulation in excel first, then want to read in outputs that have had calculations applied. If you do this, I would advise <strong>locking</strong> the sheet so that no more changes can be made. Add a “READ ME.txt” file to the folder containing the password to unlock the sheets, or stick it in a sheet at the start of the workbook. Changes will affect the data when re-read into R, post-changes.</p>
<p>.csv files are saved as comparabily small files, with no formulas or calculations, just cell values. If you need to save these cell formulas then an excel workbook will probably be preferable.</p>
<p>The <code>read_excel</code> function comes from the <code>readxl</code> package</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="reading-in-data.html#cb38-1" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb38-2"><a href="reading-in-data.html#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="reading-in-data.html#cb38-3" tabindex="-1"></a>Subjects_Allied_To_Medicine <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">&quot;Data/Multiple HESA sheets workbook.xlsx&quot;</span>, </span>
<span id="cb38-4"><a href="reading-in-data.html#cb38-4" tabindex="-1"></a>                                          <span class="at">sheet =</span> <span class="st">&quot;Subjects Allied To Medicine&quot;</span>, </span>
<span id="cb38-5"><a href="reading-in-data.html#cb38-5" tabindex="-1"></a>                                          <span class="at">range =</span> <span class="st">&quot;A17:AA237&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="sql" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> SQL<a href="reading-in-data.html#sql" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>SQL databases are a common and secure way to store data. SQL data can be loaded into R. Equally, SQL code can be run within R studio (you can tell your script to translate the code into R code, effectively).</p>
<p>Data exploration of SQL is much faster and more efficient if done in the SQL programme itself.</p>
<p>The applications below show how to load data from DfE SQL servers. The code will not work without access to the data.</p>
<div id="connecting-to-databases" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Connecting to databases<a href="reading-in-data.html#connecting-to-databases" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="reading-in-data.html#cb39-1" tabindex="-1"></a><span class="fu">library</span>(odbc)</span>
<span id="cb39-2"><a href="reading-in-data.html#cb39-2" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">odbc</span>(), <span class="at">Driver =</span> <span class="st">&quot;SQL Server&quot;</span>, </span>
<span id="cb39-3"><a href="reading-in-data.html#cb39-3" tabindex="-1"></a>                 <span class="at">Server =</span> <span class="st">&quot;T1PRMDRSQL</span><span class="sc">\\</span><span class="st">SQLPROD,55842&quot;</span>, </span>
<span id="cb39-4"><a href="reading-in-data.html#cb39-4" tabindex="-1"></a>                 <span class="at">Database =</span> <span class="st">&quot;PDR&quot;</span>,</span>
<span id="cb39-5"><a href="reading-in-data.html#cb39-5" tabindex="-1"></a>                 <span class="at">Trusted_Connection =</span> <span class="st">&quot;yes&quot;</span>)</span></code></pre></div>
</div>
<div id="loading-data-into-r" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Loading data into R<a href="reading-in-data.html#loading-data-into-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="reading-in-data.html#cb40-1" tabindex="-1"></a><span class="co"># download the data</span></span>
<span id="cb40-2"><a href="reading-in-data.html#cb40-2" tabindex="-1"></a><span class="co"># instead of &quot;Tier 1&quot; this argument might be whatever is before the full stop in front of the table name when shown in SQL. For UCAS data, for example, this is &quot;dbo&quot;</span></span>
<span id="cb40-3"><a href="reading-in-data.html#cb40-3" tabindex="-1"></a>KS4_data <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="fu">in_schema</span>(<span class="st">&quot;Tier1&quot;</span>, <span class="st">&quot;KS4_Pupil_MasterView&quot;</span>))</span>
<span id="cb40-4"><a href="reading-in-data.html#cb40-4" tabindex="-1"></a></span>
<span id="cb40-5"><a href="reading-in-data.html#cb40-5" tabindex="-1"></a><span class="co"># it is best to apply filters at this stage to improve efficiency and minimise the amount of data that R needs to extract</span></span>
<span id="cb40-6"><a href="reading-in-data.html#cb40-6" tabindex="-1"></a>students <span class="ot">&lt;-</span> KS4_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(URN,  PupilMatchingRefAnonymous, FSM6CLA) <span class="sc">%&gt;%</span> <span class="fu">collect</span>()</span></code></pre></div>
</div>
<div id="running-sql-queries" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Running SQL Queries<a href="reading-in-data.html#running-sql-queries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="reading-in-data.html#cb41-1" tabindex="-1"></a><span class="co"># run a query from the connection established (as shown above)</span></span>
<span id="cb41-2"><a href="reading-in-data.html#cb41-2" tabindex="-1"></a><span class="co"># put a query in quotation marks</span></span>
<span id="cb41-3"><a href="reading-in-data.html#cb41-3" tabindex="-1"></a><span class="co"># An example query has been left in quotation marks for clarity</span></span>
<span id="cb41-4"><a href="reading-in-data.html#cb41-4" tabindex="-1"></a></span>
<span id="cb41-5"><a href="reading-in-data.html#cb41-5" tabindex="-1"></a>output_data <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">&quot;</span></span>
<span id="cb41-6"><a href="reading-in-data.html#cb41-6" tabindex="-1"></a><span class="st">                                select distinct [Postcode], [Quintile]</span></span>
<span id="cb41-7"><a href="reading-in-data.html#cb41-7" tabindex="-1"></a><span class="st">                                from [HE-AN-DATA-NS].[Geography].[OfS_POLARPostcode]</span></span>
<span id="cb41-8"><a href="reading-in-data.html#cb41-8" tabindex="-1"></a><span class="st">                                where [Measure] = &#39;Polar4_quintile&#39;</span></span>
<span id="cb41-9"><a href="reading-in-data.html#cb41-9" tabindex="-1"></a><span class="st">                          &quot;</span>)</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="creating-outputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tomambroseharris/HE_R_Training/edit/master/04-Reading_In_Data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/tomambroseharris/HE_R_Training/blob/master/04-Reading_In_Data.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
